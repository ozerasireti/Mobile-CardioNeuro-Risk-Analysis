<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZGL BioSignal Analyzer v3.0</title>

<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:#0f172a;
    color:white;
}

header{
    text-align:center;
    padding:40px;
    background:linear-gradient(135deg,#1e3a8a,#2563eb);
}

.container{
    max-width:1000px;
    margin:30px auto;
    padding:20px;
}

.card{
    background:#1e293b;
    padding:25px;
    margin-bottom:25px;
    border-radius:12px;
}

button{
    padding:12px 25px;
    border:none;
    border-radius:30px;
    background:#2563eb;
    color:white;
    cursor:pointer;
    margin-top:10px;
}

button:hover{
    background:#1e40af;
}

input{
    margin-top:10px;
}

#result, #neuroResult{
    margin-top:20px;
    font-size:17px;
}
</style>
</head>

<body>

<header>
<h1>ZGL BioSignal Analyzer v3.0</h1>
<p>Ziya GÃ¶kalp Anadolu Lisesi â€¢ TÃœBÄ°TAK Proje TaslaÄŸÄ±</p>
</header>

<div class="container">

<div class="card">
<h2>ðŸ“ˆ EKG Analizi</h2>
<input type="file" id="imageUpload" accept="image/*">
<br>
<button onclick="analyzeImage()">EKG Analiz Et</button>
<canvas id="canvas" style="display:none;"></canvas>
<div id="result"></div>
</div>

<div class="card">
<h2>âš¡ NÃ¶ro-Motor Reaksiyon Testi</h2>
<p>HazÄ±r ol butona bas. Ekran yeÅŸile dÃ¶ndÃ¼ÄŸÃ¼nde dokun.</p>
<button onclick="startTest()">Testi BaÅŸlat</button>
<div id="reactionBox" style="width:100%;height:120px;background:#334155;margin-top:20px;border-radius:10px;"></div>
<div id="neuroResult"></div>
</div>

</div>

<footer style="text-align:center;padding:20px;background:#0f172a;">
HazÄ±rlayan: Muhammed Ekrem Ã–zer â€¢ 9-C
</footer>

<script>

let uploadedImage = new Image();

document.getElementById("imageUpload").addEventListener("change", function(event){
    const reader = new FileReader();
    reader.onload = function(){
        uploadedImage.src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
});

function analyzeImage(){

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = uploadedImage.width;
    canvas.height = uploadedImage.height;
    ctx.drawImage(uploadedImage,0,0);

    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const data = imageData.data;

    let waveform = [];

    for(let x=0; x<canvas.width; x++){
        let sum = 0;
        for(let y=0; y<canvas.height; y++){
            let i = (y*canvas.width + x)*4;
            let gray = (data[i]+data[i+1]+data[i+2])/3;
            sum += gray;
        }
        waveform.push(255-(sum/canvas.height));
    }

    let peaks=[];
    for(let i=2;i<waveform.length-2;i++){
        if(waveform[i]>waveform[i-1] &&
           waveform[i]>waveform[i+1] &&
           waveform[i]>40){
           peaks.push(i);
        }
    }

    if(peaks.length<2){
        document.getElementById("result").innerHTML="Yeterli R tepesi bulunamadÄ±.";
        return;
    }

    let intervals=[];
    for(let i=1;i<peaks.length;i++){
        intervals.push(peaks[i]-peaks[i-1]);
    }

    let avg = intervals.reduce((a,b)=>a+b)/intervals.length;
    let bpm = 60000/avg;

    let variance = intervals.reduce((s,v)=>s+Math.pow(v-avg,2),0)/intervals.length;
    let hrv = Math.sqrt(variance);

    document.getElementById("result").innerHTML=
    "BPM: "+bpm.toFixed(1)+"<br>"+
    "HRV: "+hrv.toFixed(2)+"<br>"+
    "R-Peak SayÄ±sÄ±: "+peaks.length;
}

// NEURO TEST
let startTime;
let timeout;

function startTest(){
    const box=document.getElementById("reactionBox");
    box.style.background="#334155";
    document.getElementById("neuroResult").innerHTML="Bekleyin...";
    
    timeout=setTimeout(()=>{
        box.style.background="green";
        startTime=Date.now();
    }, Math.random()*3000+2000);

    box.onclick=function(){
        if(box.style.background==="green"){
            let reaction=Date.now()-startTime;
            document.getElementById("neuroResult").innerHTML=
            "Reaksiyon SÃ¼resi: "+reaction+" ms";
            box.style.background="#334155";
        }
    }
}

</script>

</body>
</html>
