<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Mobil Kardiyo-Nöro Risk Analiz Sistemi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family: Arial, sans-serif;
    background:#f1f5f9;
    margin:0;
    padding:0;
}

header{
    background:#1e3a8a;
    color:white;
    padding:30px;
    text-align:center;
}

.container{
    max-width:900px;
    margin:30px auto;
    padding:20px;
}

.card{
    background:white;
    padding:20px;
    margin-bottom:20px;
    border-radius:10px;
    box-shadow:0 5px 15px rgba(0,0,0,0.1);
}

button{
    padding:10px 20px;
    background:#2563eb;
    color:white;
    border:none;
    border-radius:5px;
    cursor:pointer;
}

button:hover{
    background:#1e40af;
}

img{
    max-width:100%;
    margin-top:15px;
    border-radius:10px;
}

#result{
    margin-top:15px;
    font-size:18px;
    font-weight:bold;
}
.low{color:green;}
.mid{color:orange;}
.high{color:red;}
</style>
</head>

<body>

<header>
<h1>Mobil Kardiyo-Nöro Risk Analizi</h1>
<p>TÜBİTAK Projesi • Ziya Gökalp Anadolu Lisesi</p>
</header>

<div class="container">

<div class="card">
<h2>EKG Görseli Yükle</h2>

<input type="file" id="imageUpload" accept="image/*">
<br><br>
<button onclick="analyzeImage()">Analiz Et</button>

<canvas id="canvas" style="display:none;"></canvas>
<img id="preview">
<div id="result"></div>

</div>

<div class="card">
<h3>Etik Uyarı</h3>
<p style="color:red;">
Bu sistem tıbbi tanı koymaz. Eğitim amaçlı erken risk göstergesi sunar.
</p>
</div>

</div>

<script>

let uploadedImage = new Image();

document.getElementById("imageUpload").addEventListener("change", function(event){
    const reader = new FileReader();
    reader.onload = function(){
        uploadedImage.src = reader.result;
        document.getElementById("preview").src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
});

function analyzeImage(){

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = uploadedImage.width;
    canvas.height = uploadedImage.height;

    ctx.drawImage(uploadedImage,0,0);

    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const data = imageData.data;

    let brightnessSum = 0;
    let edgeScore = 0;

    for(let i=0; i<data.length; i+=4){
        let gray = (data[i] + data[i+1] + data[i+2]) / 3;
        brightnessSum += gray;

        if(i > 4){
            let prevGray = (data[i-4] + data[i-3] + data[i-2]) / 3;
            edgeScore += Math.abs(gray - prevGray);
        }
    }

    let avgBrightness = brightnessSum / (data.length/4);
    let normalizedEdge = edgeScore / (data.length/4);

    let resultText = "";
    let resultClass = "";

    if(normalizedEdge < 15){
        resultText = "Düşük Risk – Düzenli Sinyal Yapısı";
        resultClass = "low";
    } 
    else if(normalizedEdge < 30){
        resultText = "Orta Risk – Olası Ritim Düzensizliği";
        resultClass = "mid";
    } 
    else{
        resultText = "Yüksek Risk – Belirgin Sinyal Dalgalanması";
        resultClass = "high";
    }

    const resultDiv = document.getElementById("result");
    resultDiv.innerHTML = resultText +
        "<br><small>Analiz Skoru: " + normalizedEdge.toFixed(2) + "</small>";
    resultDiv.className = resultClass;
}

</script>

</body>
</html>
