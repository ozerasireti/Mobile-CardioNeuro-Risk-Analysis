<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZGL BioSignal Analyzer v4.0</title>

<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:#0f172a;
    color:white;
}
header{
    text-align:center;
    padding:40px;
    background:linear-gradient(135deg,#1e3a8a,#2563eb);
}
.container{
    max-width:1000px;
    margin:30px auto;
    padding:20px;
}
.card{
    background:#1e293b;
    padding:25px;
    border-radius:12px;
}
button{
    padding:12px 25px;
    border:none;
    border-radius:30px;
    background:#2563eb;
    color:white;
    cursor:pointer;
    margin-top:10px;
}
#report{
    margin-top:20px;
    background:#0f172a;
    padding:20px;
    border-radius:10px;
    white-space:pre-line;
}
</style>
</head>

<body>

<header>
<h1>ZGL BioSignal Analyzer v4.0</h1>
<p>Ziya Gökalp Anadolu Lisesi • TÜBİTAK Proje Taslağı</p>
</header>

<div class="container">
<div class="card">
<h2>EKG Görseli Yükle ve Analiz Et</h2>
<input type="file" id="imageUpload" accept="image/*">
<br>
<button onclick="analyzeImage()">Analiz Başlat</button>
<canvas id="canvas" style="display:none;"></canvas>
<div id="report"></div>
</div>
</div>

<footer style="text-align:center;padding:20px;">
Hazırlayan: Muhammed Ekrem Özer • 9-C
</footer>

<script>

let uploadedImage = new Image();

document.getElementById("imageUpload").addEventListener("change", function(event){
    const reader = new FileReader();
    reader.onload = function(){
        uploadedImage.src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
});

function analyzeImage(){

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = uploadedImage.width;
    canvas.height = uploadedImage.height;
    ctx.drawImage(uploadedImage,0,0);

    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const data = imageData.data;

    let waveform = [];

    for(let x=0; x<canvas.width; x++){
        let sum = 0;
        for(let y=0; y<canvas.height; y++){
            let i = (y*canvas.width + x)*4;
            let gray = (data[i]+data[i+1]+data[i+2])/3;
            sum += gray;
        }
        waveform.push(255-(sum/canvas.height));
    }

    let peaks=[];
    for(let i=2;i<waveform.length-2;i++){
        if(waveform[i]>waveform[i-1] &&
           waveform[i]>waveform[i+1] &&
           waveform[i]>40){
           peaks.push(i);
        }
    }

    if(peaks.length<2){
        document.getElementById("report").innerText=
        "Yeterli R tepesi tespit edilemedi.\nLütfen daha net bir EKG yükleyin.";
        return;
    }

    let intervals=[];
    for(let i=1;i<peaks.length;i++){
        intervals.push(peaks[i]-peaks[i-1]);
    }

    let avg = intervals.reduce((a,b)=>a+b)/intervals.length;
    let bpm = 60000/avg;

    let variance = intervals.reduce((s,v)=>s+Math.pow(v-avg,2),0)/intervals.length;
    let hrv = Math.sqrt(variance);

    let düzenlilik = hrv < 8 ? "Ritim düzenli görünmektedir."
                     : hrv < 20 ? "Hafif varyasyon gözlemlendi."
                     : "Belirgin ritim düzensizliği ihtimali.";

    let bpmYorum = bpm < 60 ? "Bradikardi eğilimi."
                  : bpm > 100 ? "Taşikardi eğilimi."
                  : "Normal kalp hızı aralığı.";

    let rapor =
`---- ANALİZ RAPORU ----

Toplam R-Peak: ${peaks.length}
Ortalama R-R Interval: ${avg.toFixed(2)}
BPM Tahmini: ${bpm.toFixed(1)}
HRV (Standart Sapma): ${hrv.toFixed(2)}

Ritim Analizi:
${düzenlilik}

Kalp Hızı Yorumu:
${bpmYorum}

Not:
Bu analiz görsel tabanlıdır ve klinik teşhis yerine geçmez.`;

    document.getElementById("report").innerText = rapor;
}

</script>

</body>
</html>
