<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZGL CardioNeuro v1.0</title>

<style>
:root{
    --primary:#1e3a8a;
    --accent:#2563eb;
    --bg:#f1f5f9;
    --card:#ffffff;
}

body{
    margin:0;
    font-family:"Segoe UI",Arial,sans-serif;
    background:var(--bg);
}

header{
    background:linear-gradient(135deg,#1e3a8a,#2563eb);
    color:white;
    text-align:center;
    padding:40px 20px;
}

header h1{
    margin:0;
    font-size:2em;
}

header p{
    margin-top:8px;
    opacity:0.95;
}

.container{
    max-width:950px;
    margin:30px auto;
    padding:20px;
}

.card{
    background:var(--card);
    padding:25px;
    margin-bottom:25px;
    border-radius:12px;
    box-shadow:0 10px 25px rgba(0,0,0,0.08);
}

.card h2{
    margin-top:0;
    color:#1e3a8a;
}

input{
    margin-top:10px;
}

button{
    margin-top:15px;
    padding:12px 30px;
    border:none;
    border-radius:30px;
    background:var(--accent);
    color:white;
    font-size:15px;
    cursor:pointer;
    transition:0.2s;
}

button:hover{
    background:#1e40af;
}

img{
    max-width:100%;
    margin-top:20px;
    border-radius:10px;
    box-shadow:0 4px 15px rgba(0,0,0,0.15);
}

#result{
    margin-top:20px;
    font-size:18px;
    font-weight:600;
}

.low{color:green;}
.mid{color:#d97706;}
.high{color:#dc2626;}

footer{
    text-align:center;
    padding:25px;
    background:#0f172a;
    color:white;
    margin-top:40px;
    font-size:14px;
}
</style>
</head>

<body>

<header>
    <h1>ZGL CardioNeuro v1.0</h1>
    <p>Ziya Gökalp Anadolu Lisesi • TÜBİTAK Proje Taslağı</p>
</header>

<div class="container">

<div class="card">
<h2>EKG Görseli Yükle</h2>
<p>Lütfen akıllı saat veya EKG çıktısını yükleyiniz.</p>

<input type="file" id="imageUpload" accept="image/*">
<br>
<button onclick="analyzeImage()">Analizi Başlat</button>

<canvas id="canvas" style="display:none;"></canvas>
<img id="preview">
<div id="result"></div>
</div>

<div class="card">
<h2>Sistem Açıklaması</h2>
<p>
Bu sistem, yüklenen EKG görüntüsünü piksel yoğunluğu ve kenar değişim analizi ile inceleyerek
ritim düzensizliği göstergesi üretir. Klinik teşhis amacı taşımaz.
</p>
</div>

</div>

<footer>
    <div style="font-weight:600; font-size:16px;">
        ZGL CardioNeuro v1.0
    </div>
    <div style="margin-top:8px;">
        Hazırlayan: <strong>Muhammed Ekrem Özer</strong>
    </div>
    <div>
        Sınıf: 9-C
    </div>
    <div style="margin-top:10px; opacity:0.7;">
        © 2026 Ziya Gökalp Anadolu Lisesi
    </div>
</footer>

<script>

let uploadedImage = new Image();

document.getElementById("imageUpload").addEventListener("change", function(event){
    const reader = new FileReader();
    reader.onload = function(){
        uploadedImage.src = reader.result;
        document.getElementById("preview").src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
});

function analyzeImage(){

    if(!uploadedImage.src){
        alert("Lütfen önce bir görsel yükleyiniz.");
        return;
    }

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = uploadedImage.width;
    canvas.height = uploadedImage.height;

    ctx.drawImage(uploadedImage,0,0);

    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const data = imageData.data;

    let edgeScore = 0;

    for(let i=4; i<data.length; i+=4){
        let grayCurrent = (data[i] + data[i+1] + data[i+2]) / 3;
        let grayPrev = (data[i-4] + data[i-3] + data[i-2]) / 3;
        edgeScore += Math.abs(grayCurrent - grayPrev);
    }

    let normalizedScore = edgeScore / (data.length/4);

    let resultText="";
    let resultClass="";

    if(normalizedScore < 15){
        resultText="Düşük Risk – Düzenli Ritim Göstergesi";
        resultClass="low";
    }
    else if(normalizedScore < 30){
        resultText="Orta Risk – Olası Ritim Düzensizliği";
        resultClass="mid";
    }
    else{
        resultText="Yüksek Risk – Belirgin Dalga Düzensizliği";
        resultClass="high";
    }

    document.getElementById("result").innerHTML =
        resultText + "<br><small>Analiz Skoru: " +
        normalizedScore.toFixed(2) + "</small>";

    document.getElementById("result").className = resultClass;
}

</script><script>

let uploadedImage = new Image();

document.getElementById("imageUpload").addEventListener("change", function(event){
    const reader = new FileReader();
    reader.onload = function(){
        uploadedImage.src = reader.result;
        document.getElementById("preview").src = reader.result;
    }
    reader.readAsDataURL(event.target.files[0]);
});

function analyzeImage(){

    if(!uploadedImage.src){
        alert("Lütfen önce bir EKG görseli yükleyiniz.");
        return;
    }

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = uploadedImage.width;
    canvas.height = uploadedImage.height;

    ctx.drawImage(uploadedImage,0,0);

    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const data = imageData.data;

    let waveform = [];

    // Her sütundaki ortalama koyuluk
    for(let x=0; x<canvas.width; x++){
        let columnSum = 0;
        for(let y=0; y<canvas.height; y++){
            let index = (y*canvas.width + x) * 4;
            let gray = (data[index] + data[index+1] + data[index+2]) / 3;
            columnSum += gray;
        }
        waveform.push(255 - (columnSum / canvas.height));
    }

    // Tepe noktası tespiti
    let peaks = [];
    for(let i=2; i<waveform.length-2; i++){
        if(waveform[i] > waveform[i-1] &&
           waveform[i] > waveform[i+1] &&
           waveform[i] > 30){   // eşik
            peaks.push(i);
        }
    }

    if(peaks.length < 2){
        document.getElementById("result").innerHTML =
        "Yeterli R tepesi tespit edilemedi.";
        return;
    }

    // R-R interval hesaplama
    let intervals = [];
    for(let i=1; i<peaks.length; i++){
        intervals.push(peaks[i] - peaks[i-1]);
    }

    let avgInterval = intervals.reduce((a,b)=>a+b,0) / intervals.length;

    // BPM tahmini (görsel genişliğine göre normalize)
    let bpm = 60000 / avgInterval;

    // HRV (standart sapma)
    let mean = avgInterval;
    let variance = intervals.reduce((sum,val)=>sum + Math.pow(val-mean,2),0)/intervals.length;
    let hrv = Math.sqrt(variance);

    let riskText="";
    if(hrv < 5){
        riskText="Düşük HRV – Olası ritim baskılanması";
    }
    else if(hrv < 15){
        riskText="Orta HRV – Normal varyasyon";
    }
    else{
        riskText="Yüksek HRV – Düzensiz ritim ihtimali";
    }

    document.getElementById("result").innerHTML = `
        BPM Tahmini: ${bpm.toFixed(1)}<br>
        HRV: ${hrv.toFixed(2)}<br>
        R Peak Sayısı: ${peaks.length}<br>
        Değerlendirme: ${riskText}
    `;
}

</script>


</body>
</html>
